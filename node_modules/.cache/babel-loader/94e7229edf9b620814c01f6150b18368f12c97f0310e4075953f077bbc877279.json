{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nconst initialState = {\n  basketLS: [],\n  totalPrice: 0,\n  totalBasketCount: 0\n};\nexport const basketSlice = createSlice({\n  name: 'basketShop',\n  initialState,\n  reducers: {\n    addProduct: (state, action) => {\n      const {\n        id,\n        totalItemPrice,\n        count,\n        image,\n        title,\n        itemPrice\n      } = action.payload;\n      localStorage.setItem(id.toString(), JSON.stringify({\n        title,\n        itemPrice,\n        totalItemPrice,\n        count,\n        image\n      }));\n      const savedItemKeys = Object.keys(localStorage);\n      state.basketLS = savedItemKeys.map(id => {\n        const item = JSON.parse(localStorage.getItem(id));\n        return {\n          id,\n          ...item\n        };\n      });\n      state.totalBasketCount = state.basketLS.reduce((acc, item) => {\n        return acc + item.count;\n      }, 0);\n      state.totalPrice = state.basketLS.reduce((acc, item) => {\n        return acc + item.totalItemPrice;\n      }, 0).toFixed(2);\n    },\n    deleteProduct: (state, action) => {\n      const productIdToDelete = action.payload.id.toString();\n      if (localStorage.getItem(productIdToDelete)) {\n        const item = JSON.parse(localStorage.getItem(productIdToDelete));\n        if (item.count > 1) {\n          item.count -= 1;\n          item.price -= item.price * item.count;\n          state.totalPrice -= action.payload.itemPrice;\n        } else {\n          localStorage.removeItem(productIdToDelete);\n          state.totalPrice -= action.payload.totalItemPrice.toFixed(2);\n        }\n      }\n      state.totalBasketCount -= 1;\n    },\n    loadBasketFromLS: state => {\n      const savedItemKeys = Object.keys(localStorage);\n      state.basketLS = savedItemKeys.map(id => {\n        const item = JSON.parse(localStorage.getItem(id));\n        return {\n          id: Number(id),\n          ...item\n        };\n      });\n      state.totalPrice = state.basketLS.reduce((acc, item) => {\n        return acc + item.totalItemPrice;\n      }, 0).toFixed(2);\n      state.totalBasketCount = state.basketLS.reduce((acc, item) => {\n        return acc + item.count;\n      }, 0);\n    }\n  }\n});\nexport const {\n  addProduct,\n  deleteProduct,\n  loadBasketFromLS\n} = basketSlice.actions;\nexport default basketSlice.reducer;","map":{"version":3,"names":["createSlice","initialState","basketLS","totalPrice","totalBasketCount","basketSlice","name","reducers","addProduct","state","action","id","totalItemPrice","count","image","title","itemPrice","payload","localStorage","setItem","toString","JSON","stringify","savedItemKeys","Object","keys","map","item","parse","getItem","reduce","acc","toFixed","deleteProduct","productIdToDelete","price","removeItem","loadBasketFromLS","Number","actions","reducer"],"sources":["/Users/meredova_o/Desktop/Frontcat/Урок 73. Продолжаем типизацию/project/src/redux/slices/basketSlice.ts"],"sourcesContent":["import { PayloadAction, createSlice } from '@reduxjs/toolkit'\n\ntype TBasketLS = {\n    id:string,\n    title:string,\n    count: number,\n    totalItemPrice: number,\n    image: string,\n    itemPrice: number\n}\ntype TInitialState = {\n    basketLS:TBasketLS[],\n    totalPrice: number,\n    totalBasketCount:number\n}\nconst initialState: TInitialState = {\n    basketLS: [],\n    totalPrice: 0,\n    totalBasketCount: 0,\n}\n\nexport const basketSlice = createSlice({\n    name: 'basketShop',\n    initialState,\n    reducers: {\n        addProduct:(state, action:PayloadAction<TBasketLS>) => {\n\n            const {id, totalItemPrice, count, image, title, itemPrice} = action.payload \n\n            localStorage.setItem(\n                id.toString(), \n                JSON.stringify({\n                    title, \n                    itemPrice,\n                    totalItemPrice, \n                    count, \n                    image\n                })\n            )\n\n            const savedItemKeys = Object.keys(localStorage);\n\n            state.basketLS = savedItemKeys.map((id) => {\n                const item = JSON.parse(localStorage.getItem(id));\n                return {\n                    id,\n                    ...item,\n                };\n            });\n\n            state.totalBasketCount = state.basketLS.reduce((acc, item) => {\n                return acc + item.count;\n            }, 0)\n\n            state.totalPrice = state.basketLS.reduce((acc, item) => {\n                return (acc + item.totalItemPrice);\n            }, 0).toFixed(2)\n        },\n\n        deleteProduct: (state, action:PayloadAction<number>) => {\n            const productIdToDelete = action.payload.id.toString()\n            if(localStorage.getItem(productIdToDelete)) {\n                const item = JSON.parse(localStorage.getItem(productIdToDelete));\n\n                if(item.count > 1) {\n                    item.count -= 1\n                    item.price -= item.price*item.count\n                    state.totalPrice -= action.payload.itemPrice\n                } else {\n                    localStorage.removeItem(productIdToDelete);\n                    state.totalPrice -= action.payload.totalItemPrice.toFixed(2) \n                }\n            }\n            state.totalBasketCount -= 1\n        },\n\n        loadBasketFromLS: (state) => {\n            const savedItemKeys = Object.keys(localStorage);\n\n            state.basketLS = savedItemKeys.map((id) => {\n                const item = JSON.parse(localStorage.getItem(id));\n                return {\n                    id:Number(id),\n                    ...item,\n                };\n            });\n            state.totalPrice = (state.basketLS.reduce((acc, item) => {\n                return acc + item.totalItemPrice;\n            }, 0).toFixed(2))\n            state.totalBasketCount = state.basketLS.reduce((acc, item) => {\n                return acc + item.count;\n            }, 0)\n        },\n    },\n  })\n  \n  export const { addProduct, deleteProduct, loadBasketFromLS } = basketSlice.actions\n  \n  export default basketSlice.reducer"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}